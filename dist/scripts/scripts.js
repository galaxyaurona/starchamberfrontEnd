"use strict";var CKEDITOR_BASEPATH="scripts/ckeditor/";angular.module("starChamberUiApp",["ngRoute","SCNavBarDirective","ui.router","chart.js","textAngular","ckeditor","angular.panels","ui.grid","ui.grid.selection","ngBootbox","flow","ui.uploader","shagstrom.angular-split-pane","ui.bootstrap.accordion","ngResource","colorpicker.module","ui.bootstrap","xeditable","angularMoment"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){c.defaults.headers.common["X-UserInfo"]="Cherry Wong",c.defaults.headers["delete"]={"Content-Type":"application/json;charset=utf-8"},a.when("/template/create",{templateUrl:"views/createTemplate.html",controller:"CreateTemplateCtrl",resolve:{template:["templateRESTService","UserService","$q",function(a,b,c){var d=c.defer();return a.createTemplate({board:{key:b.userData.board.board.id}},function(a){d.resolve(a)}),d.promise}]}}).when("/test",{templateUrl:"views/test.html",controller:"TestCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/concern",{templateUrl:"views/concern.html",controller:"ConcernCtrl",resolve:{concerns:["UserService","ConcernService",function(a,b){return b.getConcerns(a.userData.board.id)}]}}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl",resolve:{minutes:["minuteService","UserService",function(a,b){}],meetings:["meetingService","UserService",function(a,b){return a.getMeetings(b)}],reports:["reportService","UserService",function(a,b){}]}}).when("/meeting",{templateUrl:"views/meetingmanager.html",controller:"MeetingCtrl",resolve:{meeting:["$route","meetingService",function(a,b){return b.getMeeting(a.current.params.id)}],invites:["$route","meetingService",function(a,b){return b.getInvitesMeeting(a.current.params.id)}]}}).when("/wip",{templateUrl:"views/templates.html"}).when("/information",{templateUrl:"views/information.html",controller:"InfoCtrl"}).otherwise({redirectTo:"/login"})}]).run(["$rootScope","$location","$route","UserService","$http",function(a,b,c,d,e){a.console=console,a.checkSecurityClearance=function(){d.isLogin()?("/login"==b.path()&&(d.userData.importantRole?b.path("/dashboard"):b.path("/concern")),"/concern"==b.path()||d.userData.importantRole||b.path("/concern")):"/test"!=b.path()&&b.path("/login")},a.$on("$routeChangeStart",function(b,c,d){a.checkSecurityClearance()}),a.prettifyJSON=function(a){return JSON.stringify(a,null,2)},a.dateConverter=function(a,b){if(b)var c=a/60/1e3;else var c=new Date(60*a*1e3);return c},a.timeConverter=function(a,b,c){var d=(new Date).getTimezoneOffset();if(!c){var e=new Date(60*(b+a-d)*1e3),f=e.getMinutes();return f=f>9?""+f:"0"+f,e.getHours()+":"+f}},a.timeToServer=function(a,b){var c=moment(a),d=moment(b);c.add(d.hours(),"h"),c.add(d.minutes(),"m");var e=c.valueOf()/1e3/60%1440;return console.log(e),console.log(moment(e)),e},a.dateToServer=function(a,b){var c=moment(a),d=moment(b);c.add(d.hours(),"h"),c.add(d.minutes(),"m");var e=c.valueOf()/1e3/60-c.valueOf()/1e3/60%1440;return e},a.timeFromZoneConverter=function(a,b){var c=moment(6e4*a+6e4*b);return c},a.dateFromZoneConverter=function(a,b){var c=moment(6e4*a+6e4*b);return c}}]).run(["editableOptions","amMoment",function(a,b){a.theme="bs3",b.changeLocale("de")}]),angular.module("starChamberUiApp").controller("TestCtrl",["$scope","$rootScope","$filter","$http","meetingService","concernRESTService","meetingRESTService","userRESTService","UserService","ConcernService",function(a,b,c,d,e,f,g,h,i,j){console.log("wait"),j.getConcerns(i.userData.board.id),a.submit=function(b){switch(angular.isDefined(a.jsonData)?angular.isString(a.jsonData)&&(a.jsonData=JSON.parse(a.jsonData)):a.jsonData={},a.method="",a.success=!1,b){case 1:a.method="POST";break;case 2:a.method="GET";break;case 3:a.method="PUT"}a.config="emtpy",a.header="empty",a.data="empty",a.status="empty";var c={method:a.method,url:a.backendRoute,headers:{"Content-type":"application/json"},data:a.jsonData};d(c).then(function(b){a.success=!0,a.response=JSON.stringify(b,null,4),a.config=JSON.stringify(b.config,null,4),a.data=JSON.stringify(b.data,null,4),a.status=JSON.stringify(b.status,null,4),a.header=JSON.stringify(b.headers,null,4)},function(b){a.success=!1,a.data="Error response from server"})}}]),angular.module("SCNavBarDirective",["starChamberUiApp"]).directive("scNavbar",["$location","UserService","$window",function(a,b,c){return{templateUrl:"views/partials/navbar.html",restrict:"E",replace:!0,link:function(c,d,e){c.UserService=b,c.notifications=[{link:"#/concern",content:"You have a new concern to be viewed",visited:!1},{link:"#/meeting/213",content:"You are invited to attend a meeting.",visited:!1}],c.visitedAll=function(){c.newNotification=!1,angular.forEach(c.notifications,function(a,b){a.visited=!0})},c.$watch("notifications",function(){c.newNotificationCount=0,angular.forEach(c.notifications,function(a,b){c.newNotification=c.newNotification||!a.visited,a.visited||c.newNotificationCount++})}),c.logout=function(){b.logout(),a.path("/login")},c.loadMore=function(){console.log("Calling to API load more",b)}}}}]),angular.module("starChamberUiApp").controller("LoginCtrl",["$scope","$rootScope","$location","$http","UserService",function(a,b,c,d,e){a.userService=e,a.loginInfo={username:void 0,password:void 0},a.boardSelection=!1,a.tempToken={},b.boardName="Login",a.doLogin=function(){a.loginInfo.username&&a.loginInfo.password&&e.login(a.loginInfo).then(function(b){console.log("in here too"),b.message||(a.tempToken=b,b.user.roleList.length>1?(a.roleList=b.user.roleList,console.log(a.roleList),a.boardSelection=!0):a.choosingBoard(b.user.roleList[0]))},function(b){console.log("error:",b),a.boardSelection=!1,a.loginError="Username and password combination is incorrect"},null)},a.choosingBoard=function(b){e.selectBoard(a.tempToken,b),e.userData.importantRole?c.path("/dashboard"):c.path("/concern")}}]),angular.module("starChamberUiApp").controller("ConcernCtrl",["$scope","$rootScope","$location","$filter","ConcernService","UserService","uiGridConstants","concerns",function(a,b,c,d,e,f,g,h){var i=[];a.concern={},a.concernTypes=["LostItem","Complaint","Compliment","Feedback","Other"],a.concerns=h,angular.forEach(a.concerns,function(a,b){-1==i.map(function(a){return a.value}).indexOf(a.status)&&i.push({value:a.status,label:a.status})}),a.log=function(a){console.log(a)},a.removeConcern=function(b){e.deleteConcern(b);a.concerns.indexOf(b);a.gridOptions.data=a.concerns};var j=[{field:"title",cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.showConcernDetails(row.entity)">{{row.entity.title}}</a></div>'},{field:"raised",cellFilter:'date:"dd/MM/yyyy"',filterCellFiltered:!0,width:"15%"}];a.gridOptions={enableSorting:!0,enableFiltering:!0,columnDefs:j,data:a.concerns},b.boardName="Concern",a.submitConcern=function(){if(a.concern.title&&a.concern.description&&a.concern.type){var c={};"Other"==a.concern.type?c._class="Concern":c._class=a.concern.type,a.tempConcern=angular.copy(a.concern),a.tempConcern.type=void 0,c.Concern=a.tempConcern,c.Concern.date=b.dateToServer((new Date).valueOf()),c.Concern.role={key:f.userData.board.id},c.Concern.fileList=[],console.log(c),e.postConcern(c).then(function(){a.concern={},a.concernMessage="Concern successfully submitted",a.messageClass="alert-success",e.getConcerns(f.userData).then(function(a){console.log("get concerns",a)})},function(){a.messageClass="alert-danger",a.concernMessage="Error submitting concern, please try again"})}else a.messageClass="alert-danger",a.concernMessage="Concern subject,description or type is empty, cannot submit this"},a.showConcernDetails=function(b){a.concernDetail=b,$("#concern-modal").modal("show")},$("#show-modal").click(function(a){$("#concern-modal").modal("show")}),$("#close-modal").click(function(){console.log("hi"),$("#concern-modal").modal("hide")})}]),angular.module("starChamberUiApp").factory("UserService",["$rootScope","$http","$q","AuthToken","userRESTService",function(a,b,c,d,e){var f={};return f.userData={},f.originalToken={},f.login=function(a){var b=c.defer();return"manager"==a.username&&"manager"==a.password?b.resolve({id:1,name:"Dwayne Der Stein",role:"manager",avatar:"http://www.mr-butler.com/wp-content/uploads/2015/04/The-Rock-wwe-champion-hd-wallpapers.jpg"}):"user"==a.username&&"user"==a.password?b.resolve({id:2,name:"Lucy Angel ",role:"user",avatar:"http://41.media.tumblr.com/d7a4552d99639890d00b5e85d9a18673/tumblr_mldfty8fh41qcnibxo1_540.png"}):"member"==a.username&&"member"==a.password?b.resolve({id:3,name:"Julis von Reidrich",role:"member",avatar:"https://bigknickersrock.files.wordpress.com/2012/05/secretary-image1.jpg"}):e.login(a,function(a){console.log(a),"success"==a.status?b.resolve(a.data):b.reject({message:"error occurred"})}),b.promise},f.selectBoard=function(a,b){d.setToken(a),f.originalToken=a,f.userData=a.user.userData,f.userData.name=f.userData.title+". "+f.userData.givenNames+" "+f.userData.familyName,f.userData.roleList=f.originalToken,f.userData.id=f.originalToken.user.id,f.userData.role=b.name,f.userData.board=b,void 0==f.userData.avatar&&("manager"==f.userData.role?f.userData.avatar="http://www.theassociation.net/pics/jerryseinfeld/seinfeld1.jpg":"boardMember"==f.userData.role?f.userData.avatar="https://iwh-indicatorwarehou.netdna-ssl.com/wp-content/uploads/2014/02/GeorgeCostanza1.jpg":f.userData.avatar="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQXLyQnAANwYmmlTCDZ_BnGFTUHUJ1_ia62dnfX5NAvPY0dmIq5"),"normalUser"==f.userData.role?f.userData.importantRole=!1:f.userData.importantRole=!0,localStorage.setItem("currentBoard",JSON.stringify(b))},f.isLogin=function(){return d.getToken()?(f.originalToken=JSON.parse(d.getToken()),f.selectBoard(f.originalToken,JSON.parse(localStorage.getItem("currentBoard"))),!0):(f.userData={},!1)},f.logout=function(){d.setToken(),f.userData={},localStorage.removeItem("currentBoard")},f}]).factory("AuthToken",["$window",function(a){var b={};return b.getToken=function(){return a.localStorage.getItem("token")},b.setToken=function(b){b?a.localStorage.setItem("token",JSON.stringify(b)):a.localStorage.removeItem("token")},b}]),angular.module("starChamberUiApp").controller("DashboardCtrl",["$log","$scope","$rootScope","$location","$filter","UserService","meetingService","meetings","$window",function(a,b,c,d,e,f,g,h,i){console.log(f.userData),b.invites=h,console.log(b.invites),"manager"==f.userData.role?b.manager=!0:b.manager=!1,c.boardName="Dashboard",b.reverse=!1,b.moreOptionsMeeting=!1,b.moreOptionsMinute=!1,b.moreOptionsReport=!1,localStorage.setItem("sampleInvite",JSON.stringify(h[0])),b.queryInvite={response:void 0,role:void 0,meeting:{name:void 0,description:void 0,state:void 0,reschedule:void 0,lastEditedDate:void 0,lastEditedTime:void 0,cancelled:void 0,board:void 0,id:void 0},id:void 0},b.$watch("queryInvite",function(){console.log(b.queryInvite)}),b.queryMinute={title:"",date:void 0},b.statuses=["","Polling","Pending","Scheduled","Meeting"],b.toggleMoreOption=function(a){"meeting"==a&&(b.moreOptionsMeeting=!b.moreOptionsMeeting),"minute"==a&&(b.moreOptionsMinute=!b.moreOptionsMinute),"report"==a&&(b.moreOptionsReport=!b.moreOptionsReport)},b.minutes=[{title:"Monthly meeting",date:new Date("18 Feb 2015 17:30:00"),url:"/#/test/#"},{title:"Weekly meeting",date:new Date("12 March 2015 03:30:00"),url:"/#/test/#"}],b.reports=[{title:"Finance report",date:new Date("24 June 2015 17:30:00"),url:"/#/test/#"},{title:"Security report",date:new Date("29 February 2015 03:30:00"),url:"/#/test/#"}];var j=e("orderBy");b.order=function(a,c,d){"meeting"==a&&(b.invites=j(b.invites,c,d)),"report"==a&&(b.reports=j(b.reports,c,d)),"minute"==a&&(b.minutes=j(b.minutes,c,d))},b.order("meeting","status",!1),$("#close-calendar").click(function(){$("#calendar-modal").modal("hide")}),b.createNewMeeting=function(){console.log("Pressed"),console.log(f.userData);var a={name:"New Meeting",description:"",duration:0,state:"Polling",quorum:0,time:void 0,date:void 0,cutoffTime:void 0,cutoffDate:void 0,location:"",reschedule:!1,lastEditedDate:Math.round((new Date).valueOf()/60/1e3),lastEditedTime:Math.round((new Date).valueOf()/60/1e3),cancelled:!1,board:{key:f.userData.board.board.id},availabilities:void 0,id:void 0};g.postMeeting(a).then(function(a){console.log("data:"+a.data.id);var b=a.data,c={id:void 0,meeting:{id:a.data.id},response:"pending",role:{key:f.userData.board.id}};console.log(f.userData.board.id," and ",c),g.postInvite(c).then(function(a){d.url("/meeting?id="+b.id)})})}}]),angular.module("starChamberUiApp").config(["$stateProvider",function(a){a.state("Polling",{views:{sub2:{templateUrl:"views/subviews/meetingPollOpen.html",controller:"VoteCtrl"},sub3:{templateUrl:"views/subviews/meetingAgendaOpen.html",controller:"AgendaCtrl",resolve:{agenda:["$route","agendaService",function(a,b){return b.getItems(a.current.params.id)}]}},sub1:{templateUrl:"views/subviews/meetingInvitesOpen.html",controller:"InviteCtrl",resolve:{roles:["$route","meetingService","UserService",function(a,b,c){return b.getBoardRoles(c.userData.board.board.id)}]}}}}).state("Pending",{views:{sub2:{templateUrl:"views/subviews/meetingPollclosed.html",controller:"VoteCtrl"},sub3:{templateUrl:"views/subviews/meetingAgendaOpen.html",controller:"AgendaCtrl",resolve:{agenda:["$route","agendaService",function(a,b){return b.getItems(a.current.params.id)}]}},sub1:{templateUrl:"views/subviews/meetingInvitesOpen.html",controller:"InviteCtrl",resolve:{roles:["$route","meetingService","UserService",function(a,b,c){return b.getBoardRoles(c.userData.board.board.id)}]}}}}).state("Scheduled",{views:{sub2:{templateUrl:"views/subviews/meetingAttendance.html",controller:"VoteCtrl"},sub3:{templateUrl:"views/subviews/meetingAgendaClosed.html",controller:"AgendaCtrl",resolve:{agenda:["$route","agendaService",function(a,b){return b.getItems(a.current.params.id)}]}}}}).state("Lobby",{views:{sub2:{template:"Im the lobbyist sub2"},sub3:{template:"Im the lobbyist sub 3"}}}).state("Meeting",{views:{sub4:{templateUrl:"views/subviews/meetingMinutes.html",controller:"MinuteTakingCtrl",resolve:{agendaItems:["agendaService","meetingService","$state","$route",function(a,b,c,d){return a.getItems(d.current.params.id)}],minute:["minuteService","meetingService","$state","$route",function(a,b,c,d){return a.getMinute(d.current.params.id)}]}}}}).state("Closed",{views:{sub4:{templateUrl:"views/subviews/meetingMinutes.html",controller:"MinuteTakingCtrl",resolve:{agendaItems:["agendaService","meetingService","$state","$route",function(a,b,c,d){return a.getItems(d.current.params.id)}],minute:["minuteService","meetingService","$state","$route",function(a,b,c,d){return a.getMinute(d.current.params.id)}]}}}})}]),angular.module("starChamberUiApp").controller("MeetingCtrl",["$scope","$rootScope","$location","$state","$routeParams","meetingService","UserService","invites","meeting","agendaService","pollService","minuteRESTService","$interval","moment",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b){for(var c=""+a;c.length<b;)c="0"+c;return c}a.state=d,angular.isDefined(i)?(a.meeting=i,console.log(a.meeting),a.invites=h,console.log("this is the invites",a.invites)):(console.log("not defined"),a.meeting={name:"",description:"",duration:0,state:"Polling",quorum:0,time:void 0,date:void 0,cutoffTime:new Date,cutoffDate:new Date,location:"",reschedule:!0,lastEditedDate:new Date,lastEditedTime:void 0,cancelled:!1,board:{key:g.userData.board.id},availabilities:[],id:void 0}),a.lobbyState=function(){a.meeting.state="Lobby",d.transitionTo("Lobby")},m(function(){"Lobby"==a.meeting.state&&"boardMember"==g.userData.role&&f.getMeeting(a.meeting.id).then(function(b){"Meeting"==b.state&&(a.meeting=b,d.transitionTo("Meeting"))})},3e4),a.timezone=(new Date).getTimezoneOffset(),a.timezone=(a.timezone<0?"+":"-")+o(parseInt(Math.abs(a.timezone/60)),2)+o(Math.abs(a.timezone%60),2),a.timezone="GTM"+a.timezone,a.refToMeeting={},a.refToMeeting.meeting=i,console.log("meeting213",a.meeting),b.boardName="Meeting manager",d.transitionTo(a.meeting.state),console.log("current state",d,a.meeting.state),a.formattedAvailabilities,console.log("State set to "+a.meeting.state),a.createFormattedAvailabilities=function(){a.formattedAvailabilities=angular.copy(a.meeting.availabilities),a.formattedAvailabilities.forEach(function(a){a.tempDate=angular.copy(a.date),a.tempTimeStart=angular.copy(a.timeStart),a.tempTimeEnd=angular.copy(a.timeEnd),a.date=b.dateFromZoneConverter(a.date,a.timeStart),a.timeStart=b.timeFromZoneConverter(a.tempDate,a.timeStart),a.timeEnd=b.timeFromZoneConverter(a.tempDate,a.timeEnd)})},a.createFormattedAvailabilities(),"manager"==g.userData.role?a.manager=!0:a.manager=!1,a.postMeeting=function(){f.postMeeting(a.meeting).then(function(a){console.log("up up",a)})},a.contains=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},a.$watch("meeting",function(){console.log(a.meeting),f.updateMeeting(a.meeting).then(function(b){console.log(b),console.log("Meeting updated"),a.meeting=b.data,a.manager&&a.managerCreatedVote()})},!0),a.managerCreatedVote=function(){console.log(a.meeting.availabilities),a.meeting.availabilities.length>0&&angular.forEach(a.invites,function(b,c){if(b.role.key==g.userData.board.id){var d=!1;angular.forEach(a.invites[a.invites.indexOf(b)].avaliabilities,function(b,c){b.date==a.meeting.availabilities[0].date&&b.timeEnd==a.meeting.availabilities[0].timeEnd&&b.timeStart==a.meeting.availabilities[0].timeStart&&(d=!0)}),d||k.vote(a.meeting.availabilities[0],a.invites)}})},a.startMeeting=function(){console.log("board: ",g.userData.board.board),a.meeting.key=a.meeting.id,a.tempBoard=g.userData.board.board,a.tempBoard.key=a.tempBoard.id,l.createMinute({meeting:a.meeting,board:a.tempBoard},function(b){"success"==b.status&&(a.meeting.state="Meeting",d.transitionTo("Meeting"))})},a.cancelMeeting=function(){a.meeting.cancelled=!0},a.setStyle=function(a){document.getElementById("tester").setAttribute("href",a)},a.validateName=function(a){return a.length>40?"Name limited to 40 characters!":void 0},a.validateDesc=function(a){return a.length>200?"Description limited to 200 characters!":void 0},a.validateLoc=function(a){return a.length>45?"Location limited to 45 characters!":void 0}}]),angular.module("starChamberUiApp").factory("meetingService",["$filter","$http","$q","meetingRESTService","UserService",function(a,b,c,d,e){var f={};return f.meetingFilter=function(a,b){for(var c=[],d=0;d<a.length;++d){var e=!1;if(a[d].invite.length>0)for(var f=0;f<a[d].invite.length;++f)a[d].invite[f].id==b&&(e=!0);e&&c.unshift(a[d]),a[d].chairmanId==b&&c.unshift(a[d])}return c},f.getMeetings=function(a){var d=angular.copy(e);a==e&&(console.log(d.userData),a=e.userData.board.id);var f=c.defer();return b.get("http://www.ltuteamg.com:8000/api/invite/role?id="+a,{}).success(function(a){f.resolve(a.data)}),f.promise},f.getInvitesMeeting=function(a){var d=c.defer();return b.get("http://www.ltuteamg.com:8000/api/invite/meeting?id="+a,{}).success(function(a){d.resolve(a.data)}),d.promise},f.getBoardRoles=function(a){var d=c.defer();return b.get("http://www.ltuteamg.com:8000/api/users/board?id="+a,{}).success(function(a){d.resolve(a.data)}),d.promise},f.getMeeting=function(a){var b=c.defer();return d.getMeeting({id:a},function(a){console.log("data",a),void 0!=a.data?b.resolve(a.data):b.reject({error:"cannot get meeting"})},function(a){console.log(a),b.reject({error:"cannot get meeting"})}),b.promise},f.updateMeeting=function(a){var b=c.defer();return console.log(a),d.updateMeeting(a,function(a){b.resolve(a)}),console.log(b.promise),b.promise},f.postMeeting=function(a){var b=c.defer();return a.id=void 0,d.postMeeting(a,function(a){b.resolve(a)}),console.log(f.meetings),b.promise},f.postInvite=function(a){console.log(a);var d=c.defer();return b.post("http://www.ltuteamg.com:8000/api/invite/i",{avaliabilities:a.avaliabilities,id:a.id,response:a.response,role:a.role,meeting:a.meeting}).success(function(a){d.resolve(a.data)}),d.promise},f.deleteInvite=function(a){console.log(a);var d=c.defer();return b["delete"]("http://www.ltuteamg.com:8000/api/invite/i?id="+a,{}).success(function(a){d.resolve(a.data)}),d.promise},f}]);var backendRoute="http://www.ltuteamg.com:8000/api/";angular.module("starChamberUiApp").factory("concernRESTService",["$resource",function(a){var b="concerns";return a(backendRoute+b,{},{getConcerns:{method:"GET",url:backendRoute+b+"/role?"},getConcern:{method:"GET",url:backendRoute+b+"/c?"},postConcern:{method:"POST",url:backendRoute+b+"/c?"}})}]).factory("userRESTService",["$resource",function(a){var b="users";return a(backendRoute+b,{},{login:{method:"POST",url:backendRoute+b+"/auth"}})}]).factory("meetingRESTService",["$resource",function(a){var b="meetings";return a(backendRoute+b,{},{getMeeting:{method:"GET",url:backendRoute+b+"/m?"},postMeeting:{method:"POST",url:backendRoute+b+"/m"},updateMeeting:{method:"PUT",url:backendRoute+b+"/m"},getMeetingsMinute:{method:"GET",url:backendRoute+b+"/minute?"}})}]).factory("minuteRESTService",["$resource",function(a){var b="notes";return a(backendRoute+b,{},{getNotes:{method:"GET",url:backendRoute+b+"/discus"},createNote:{method:"POST",url:backendRoute+b+"/n"},updateNote:{method:"PUT",url:backendRoute+b+"/n"},getNote:{method:"GET",url:backendRoute+b+"/n"},createMinute:{method:"POST",url:backendRoute+"minutes/m"},getMinute:{method:"GET",url:backendRoute+"minute/meeting"},updateMinute:{method:"PUT",url:backendRoute+"minutes/m"},createDecision:{method:"POST",url:backendRoute+"decisions/d"},updateDecision:{method:"PUT",url:backendRoute+"decisions/d"},getDecision:{method:"GET",url:backendRoute+"decisions/d?"},getVote:{method:"GET",url:backendRoute+"decisions/d?"},vote:{method:"PUT",url:backendRoute+"decisionsOptions/o"},unvote:{method:"DELETE",url:backendRoute+"decisionsOptions/o"}})}]).factory("reportRESTService",["$resource",function(a){return a(backendRoute+itemRESTRoute,{},{})}]).factory("inviteRESTService",["$resource",function(a){var b="invite";return a(backendRoute+b,{},{updateInvite:{method:"PUT",url:backendRoute+b+"/i"}})}]).factory("notificationRESTService",["$resource",function(a){return a(backendRoute+itemRESTRoute,{},{})}]).factory("templateRESTService",["$resource",function(a){return a(backendRoute,{},{createTemplate:{method:"POST",url:backendRoute+"templates/t"},updateTemplate:{method:"PUT",url:backendRoute+"templates/t"}})}]),angular.module("starChamberUiApp").controller("AgendaCtrl",["$scope","$rootScope","agendaService","$routeParams","UserService","agenda","ConcernService",function(a,b,c,d,e,f,g){a.agendaItems=f,console.log("Agenda"),console.log(a.agendaItems),a.showRemovedItems=!1,a.queryAgendaOpen=function(b){return"Pending"==b.approvalStatus||"Approved"==b.approvalStatus?!0:a.showRemovedItems&&"Rejected"==b.approvalStatus?!0:!1},a.queryAgendaClosed=function(b){return"Approved"==b.approvalStatus?!0:a.showRemovedItems&&"Rejected"==b.approvalStatus?!0:!1},a.showAddItemModal=function(){$("#addItemModal").modal("show")},$("#close-addItemModal").click(function(){$("#addItemModal").modal("hide")}),a.addFail=!1,a.failMessage="Please enter ALL text fields!",$("#submit-Item").click(function(){$("#newTitle").val()&&$("#newDescription").val()&&$("#newDuration").val()?isNaN($("#newDuration").val())?(a.failMessage="Please enter only numberics for duration!",a.addFail=!0,a.$apply()):(a.newItem($("#newTitle").val(),$("#newDescription").val(),$("#newDuration").val()),a.addFail=!1,$("#newTitle").val(""),$("#newDescription").val(""),$("#newDuration").val(""),$("#addItemModal").modal("hide")):(a.failMessage="Please enter ALL text fields!",a.addFail=!0,a.$apply())}),a.selectedAttachmentType="null",a.selectedAttachment,a.newItem=function(b,d,f){if("null"==a.selectedAttachmentType)var g={_class:"DiscussionItem",title:b,description:d,duration:parseInt(f),approvalStatus:"Pending",decision:void 0,date:void 0,order:a.agendaItems.length,id:void 0,time:void 0,role:{key:e.userData.board.id},meeting:a.meeting};else if("concern"==a.selectedAttachmentType)var g={_class:"Concern_Discussion",concernId:a.selectedAttachment.id,DiscussionItem:{title:b,description:d,duration:parseInt(f),approvalStatus:"Pending",decision:void 0,date:void 0,order:a.agendaItems.length,id:void 0,time:void 0,role:{key:e.userData.board.id},meeting:a.meeting}};console.log(g),console.log("Agenda Item Created"),c.postAgendaItem(g).then(function(b){a.agendaItems.push(g),console.log("upper layer response: ",b)}),a.$apply()},a.confirmItem=function(b){b.approvalStatus="Approved",a.updateTime(),$(".modal.in").modal("hide"),console.log("Agenda Item updated"),c.updateAgendaItem(b).then(function(a){console.log("upper layer response: ",a)})},a.denyItem=function(a){a.approvalStatus="Rejected",$("#pendingItemModal").modal("hide"),console.log("Agenda Item updated"),c.updateAgendaItem(a).then(function(a){console.log("upper layer response: ",a)})},$("#close-pendingItemModal").click(function(){$("#pendingItemModal").modal("hide")}),a.approvedItems=0,a.pendingItems=0,a.rejectedItems=0,a.totalTime=0,a.overTime=!1,a.updateTime=function(){a.totalTime=0;for(var b=0;b<a.agendaItems.length;b++)"Approved"==a.agendaItems[b].approvalStatus?(a.totalTime+=a.agendaItems[b].duration,a.approvedItems++):"Pending"==a.agendaItems[b].approvalStatus?a.pendingItems++:a.rejectedItems++;a.totalTimePercent=a.totalTime/a.meeting.duration*100,a.totalTime>a.meeting.duration?a.overTime=!0:a.overTime=!1},a.updateTime(),a.getPercent=function(){return totalTimePercent},$("#close-pendingItemModal").click(function(){$("#pendingItemModal").modal("hide")}),a.selectedList,a.$watch("selectedList",function(){console.log("selected list changed to: "+a.selectedList),"concern"==a.selectedList&&void 0==a.concernList?g.getConcerns(e.userData.board.id).then(function(b){a.concernList=b}):"report"==a.selectedList||"discussionItem"==a.selectedList}),a.selectedList="concern",a.addConcernToItem=function(b){a.selectedAttachment=b,a.selectedAttachmentType="concern",a.selectedList="done"},a.removeSelection=function(){a.selectAttachment="",a.selectedAttachmentType="null",a.selectedList="concern"},a.showAddItemModal=function(){$("#addItemModal").modal("show")},$("#close-addItemModal").click(function(){$("#addItemModal").modal("hide")}),$("#submit-item").click(function(){a.newItem($("#newTitle"),$("#newDescription"),$("#newDuration"),$("#newAttachment")),$("#addItemModal").modal("hide")}),a.showRemoved=function(){a.showRemovedItems=!0},a.hideRemoved=function(){a.showRemovedItems=!1}}]),angular.module("starChamberUiApp").factory("agendaService",["$q","$http","minuteRESTService",function(a,b,c){var d={};return d.getItems=function(c){var d=a.defer();return b.get("http://www.ltuteamg.com:8000/api/discus/meeting?id="+c,{}).success(function(a){d.resolve(a.data)}),d.promise},d.postAgendaItem=function(c){var d=a.defer();return b.post("http://www.ltuteamg.com:8000/api/discus/d",c).success(function(a){d.resolve(a.data)}),d.promise},d.updateAgendaItem=function(c){var d=a.defer();return console.log(c),b.put("http://www.ltuteamg.com:8000/api/discus/d",c).success(function(a){d.resolve(a.data)}),d.promise},d}]),angular.module("starChamberUiApp").controller("VoteCtrl",["$scope","$rootScope","pollService","$routeParams","UserService","$filter","inviteRESTService","moment",function(a,b,c,d,e,f,g,h){a.pollTimePicker=new Date(0),a.cutoffTimePicker=new Date(0),a.pollData={label:[],data:[],id:[],voted:[]},a.calculateDohnut=function(){a.pollData={label:[],data:[],id:[],voted:[]},a.containsTime=[];for(var b=0;b<a.meeting.availabilities.length;++b)a.pollData.label.push(h(a.dateFromZoneConverter(a.meeting.availabilities[b].date,a.meeting.availabilities[b].timeStart)).format("DD/MM/YYYY")+" : "+h(a.timeFromZoneConverter(a.meeting.availabilities[b].date,a.meeting.availabilities[b].timeStart)).format("ddd, hh:mm a")+" to "+h(a.timeFromZoneConverter(a.meeting.availabilities[b].date,a.meeting.availabilities[b].timeEnd)).format("ddd, hh:mm a")),a.pollData.data.push(0),a.pollData.id.push(a.meeting.availabilities[b].id),a.pollData.voted.push({votes:[]});a.invites.forEach(function(b){b.avaliabilities.forEach(function(c){a.pollData.id.forEach(function(d){d==c.id&&(a.pollData.voted[a.pollData.id.indexOf(d)].votes.push(b.role.key),a.pollData.data[a.pollData.id.indexOf(d)]++)})})})},a.calculateDohnut(),a.alertText,a.alertShow=!1,a.addMeetingTime=function(d,e){if(a.meeting.availabilities.length<12){var f=h(e),g=h(e);console.log(g),g.add(a.meeting.duration,"m"),console.log(g),a.temp={date:b.dateToServer(d,f),timeStart:b.timeToServer(d,f),timeEnd:b.timeToServer(d,g),id:void 0},console.log("heres temp"),console.log(a.temp),c.postPoll(a.meeting,a.temp),a.createFormattedAvailabilities(),$("#timeModal").modal("hide")}else a.alertText="Maximum time poll limit reached!",a.alertShow=!0},a.deleteMeetingTime=function(b){for(var c=0;c<a.meeting.availabilities.length;++c)a.meeting.availabilities[c].id==b&&a.meeting.availabilities.splice(c,1);a.createFormattedAvailabilities()},a.vote=function(b){c.vote(b,a.invites),a.calculateDohnut()},a.containsTimeCalculation=function(b){var c=0;a.invites.forEach(function(d){if(d.role.key==e.userData.board.id){for(var f=0;f<d.avaliabilities.length;){if(d.avaliabilities[f].id==b.id){c=1;break}f++}0==c?a.containsTime[b.id]=!1:a.containsTime[b.id]=!0}})},angular.forEach(a.meeting.availabilities,function(b,c){a.containsTimeCalculation(b)}),a.setCutOff=function(c,d){var e=angular.copy(c);e.setHours(d.getHours()),e.setMinutes(d.getMinutes());var f=h(e);f>=h()?(a.meeting.cutoffDate=b.dateToServer(c,d),a.meeting.cutoffTime=b.timeToServer(c,d),console.log(a.meeting),a.setCutOffError="",$("#reModal").modal("hide")):a.setCutOffError="Cut off date cannot be in the past"},a.setMeeting=function(b,c){console.log(b),a.meeting.date=b,a.meeting.time=c,a.meeting.state="Scheduled"},a.reschedule=function(b,c){a.setMeeting(b,c),a.meeting.state="Polling"},a.showPollModal=function(){$("#timeModal").modal("show")},$("#close-Poll").click(function(){$("#timeModal").modal("hide")}),a.showCutoffModal=function(){$("#reModal").modal("show")},$("#close-Cutoff").click(function(){$("#reModal").modal("hide")})}]),angular.module("starChamberUiApp").factory("pollService",["UserService","inviteRESTService",function(a,b){var c={};return c.postPoll=function(a,b){console.log("poll object",b),a.availabilities.unshift(b)},c.vote=function(c,d){var e=0;d.forEach(function(d){if(d.role.key==a.userData.board.id){for(var f=0;f<d.avaliabilities.length;){if(d.avaliabilities[f].id==c.id){e=1;break}f++}if(0==e){var g=angular.copy(c);void 0!=g.tempDate&&(g.date=angular.copy(c.tempDate),g.timeStart=angular.copy(c.tempTimeStart),g.timeEnd=angular.copy(c.tempTimeEnd),g.tempTimeEnd=void 0,g.tempTimeStart=void 0,g.tempDate=void 0),d.avaliabilities.push(g)}else d.avaliabilities.splice(f,1);console.log("inv",d),b.updateInvite(d,function(a){console.log("here is the response after update invite",a)})}})},c}]),angular.module("starChamberUiApp").controller("InviteCtrl",["$scope","$rootScope","roles","meetingService",function(a,b,c,d){a.cleanRoles=function(a){var b=0;return console.log("list",a),angular.isDefined(a)&&a.forEach(function(c){b=0,c.roleList.forEach(function(b){"normalUser"==b.name&&a.splice(a.indexOf(c),1)}),1==b&&a.splice(a.indexOf(c),1)}),a},a.boardRoles=a.cleanRoles(c),console.log(a.boardRoles),a.filterInvited=function(b){var c=[];return b.forEach(function(b){a.invites.forEach(function(a){b.roleList[0].id==a.role.key&&c.push(b)})}),c},console.log("Roles"),console.log(a.boardRoles),a.invitedNames=a.filterInvited(a.boardRoles.slice()),a.showNewInvite=function(){$("#addInviteModal").modal("show")},$("#close-inviteModal").click(function(){$("#addInviteModal").modal("hide")}),a.addInvited=function(b){var c={avaliabilities:[],id:void 0,meeting:a.meeting,response:"pending",role:{key:b.roleList[0].id}};a.invites.push(c),d.postInvite(c).then(function(a){console.log("upper layer response: ",a)}),a.invitedNames=a.filterInvited(a.boardRoles.slice());
},a.deleteInvited=function(b){for(var c=0;c<a.invites.length;++c)if(a.invites[c].role.key==b.roleList[0].id){d.deleteInvite(a.invites[c].id).then(function(a){console.log("upper layer response: ",a)}),a.invites.splice(c,1);break}a.invitedNames=a.filterInvited(a.invitedNames)}}]),angular.module("starChamberUiApp").factory("ConcernService",["$filter","concernRESTService","$q","UserService","$rootScope",function(a,b,c,d,e){var f={};return f.getConcerns=function(a){var d=c.defer();return b.getConcerns({id:a},function(a){console.log(a),void 0==a.data?d.resolve([]):d.resolve(a.data)},function(){d.reject([])}),d.promise},f.getConcerns=function(a){var d=c.defer();return b.getConcerns({id:a},function(a){console.log("concerns",a);var b=[];void 0==a.data?d.resolve([]):(console.log("im here with data",a.data),angular.forEach(a.data,function(a,c){-1==a._class.indexOf("Concern")&&(a=a["starchamber.concerns.model.Concern"],void 0==a&&(a=a.Concern)),a.raised=new Date(60*a.raised*1e3),b.push(a)}),console.log("new responde data",b),d.resolve(b))},function(){d.reject([])}),d.promise},f.postConcern=function(a){var d=c.defer();return b.postConcern(a,function(a){console.log("response",a),"success"==a.status?d.resolve():d.reject([])}),d.promise},f.deleteConcern=function(a){var b=f.concerns.indexOf(a);f.concerns.splice(b,1)},f}]),angular.module("starChamberUiApp").factory("minuteService",["minuteRESTService","$q","UserService","$http",function(a,b,c,d){var e={};return e.getNotes=function(c){var d=b.defer();return a.getNotes({id:c},function(a){return d.resolve(a.data)}),d.promise},e.createNote=function(c){var d=b.defer();return a.createNote({discussionItem:{key:c}},function(a){return d.resolve(a.data)}),d.promise},e.updateNote=function(c){var d=b.defer();return a.updateNote(c,function(a){return d.resolve(a.data)}),d.promise},e.getNote=function(c){var d=b.defer();return a.getNote({id:c},function(a){return d.resolve(a.data)}),d.promise},e.createDecision=function(c){var d=b.defer();return a.createDecision({discussionItem:{key:c.id},name:c.decision.name},function(a){return console.log(a),d.resolve(a.data)}),d.promise},e.getDecision=function(c){var d=b.defer();return a.getDecision({id:c},function(a){return console.log("decision",a),d.resolve(a.data)}),d.promise},e.updateDecision=function(c){var d=b.defer();return a.updateDecision(c,function(a){return console.log("update decisions",a),d.resolve(a.data)}),d.promise},e.vote=function(d){var e=angular.copy(d);e.users=[],e.users.push({key:c.userData.board.id}),e.voted=void 0;var f=b.defer();return a.vote(e,function(a){console.log("vote",a),f.resolve(a)}),f.promise},e.getMinute=function(a){var c={key:a};console.log("meeting id",c);var e=b.defer();return d.get("http://www.ltuteamg.com:8000/api/minutes/meeting?id="+a).success(function(a){e.resolve(a)}),e.promise},e.unvote=function(a){var e=angular.copy(a);e.users=[],e.users.push({key:c.userData.board.id}),e.voted=void 0;var f=b.defer(),g={method:"DELETE",url:"http://www.ltuteamg.com:8000/api/decisionsOptions/o",data:e,headers:{"Content-Type":"application/json;charset=utf-8"}};return d(g).success(function(a){console.log("unvote",a),f.resolve(a)}),f.promise},e}]),angular.module("starChamberUiApp").factory("reportService",function(){var a={};return a}),angular.module("starChamberUiApp").controller("MinuteTakingCtrl",["$scope","agendaItems","UserService","$routeParams","$filter","minuteService","$interval","$sce","minute","minuteRESTService",function(a,b,c,d,e,f,g,h,i,j){function k(a){var b=!1;return console.log("role id",c.userData.board.id," user list ",a),angular.forEach(a,function(a,d){String(a.key)===String(c.userData.board.id.trim())&&(console.log("we have a match",a.key,c.userData.board.id,String(a.key)===String(c.userData.board.id)),b=!0)}),b}function l(a){return angular.forEach(a,function(b,d){b.key==c.userData.board.id&&a.splice(d,1)}),a}a.console=console,a.agendaItems=b,a.agendaItems=e("filter")(a.agendaItems,{approvalStatus:"Approved"}),a.manager="manager"==c.userData.role,a.agendaItemModified=a.agendaItems,a.hideDebugInfo=!0,console.log("agendaItem modified",a.agendaItemModified),angular.forEach(a.agendaItems,function(b,c){angular.isDefined(b.decision.key)&&f.getDecision(b.decision.key).then(function(b){a.agendaItemModified[c].decision=b,angular.forEach(a.agendaItemModified[c].decision.options,function(a,b){a.voted=k(a.users),console.log("new option",a)})}),f.getNotes(b.id).then(function(d){console.log("notes",d),0==d.length?f.createNote(b.id).then(function(b){a.agendaItemModified[c].note=b}):a.agendaItemModified[c].note=d[0]})}),a.prettifyJSON=function(a){return JSON.stringify(a,null,4)},a.voteFor=function(a,b){console.log(a,b);var c=a.decisionsLabels.indexOf(b);a.decisionsData[a.previousVote]--,a.decisionsData[c]++,a.previousVote=c},a.initedCkEditor=!1,console.log(d),a.minuteNote=localStorage.getItem("minuteNote"+d.id),a.minuteNote=angular.isDefined(a.minuteNote)?JSON.parse(a.minuteNote):"",angular.element(document).ready(function(){console.log("Hi")}),a.$on("$viewContentLoaded",function(){}),a.initCkEditor=function(b){document.getElementById("displayHTML").innerHTML=a.minuteNote},a.saveNote=function(a){f.updateNote(a).then(function(a){console.log(a)})},angular.forEach(a.agendaItems.approved,function(a,b){a.decisionsLabels=[],a.decisionsData=[],angular.forEach(a.decisions,function(b,c){console.log("value decisions"+a.decisions),a.decisionsLabels.push(b.dName),a.decisionsData.push(b.dVotes.length)})}),g(function(){"Meeting"==a.meeting.state&&"boardMember"==c.userData.role&&angular.forEach(a.agendaItemModified,function(b,c){f.getNote(b.note.id).then(function(c){b.note.text=h.trustAsHtml(c.text),console.log(b.note),console.log(a.agendaItemModified)})})},1e3),a.vote=function(a){f.vote(a).then(function(b){console.log("response status",b.status),"success"==b.status&&(a.users=b.data.users,a.voted=k(a.users),console.log("voted and this is the result",a))})},a.unvote=function(a){f.unvote(a).then(function(b){"success"==b.status&&(console.log("Removing ",l(a.users)),a.users=l(a.users),a.voted=k(a.users),console.log("unvoted and this is the result",a)),a.voted=!1})},a.addQuestion=function(a,b){a.decision.name=b,console.log(a),f.createDecision(a).then(function(b){a.decision=b})},a.addOption=function(a){var b=angular.copy(a.decision);b.options.push(b.newOption),b.newOption=void 0,f.updateDecision(b).then(function(b){a.decision=b,angular.forEach(a.decision.options,function(a,b){a.voted=k(a.users)})})},a.endMeeting=function(){var b=i.data[0];b.status="Closed",j.updateMinute(b,function(b){a.meeting.state="Closed",alert("Closed the meeting")})}}]),angular.module("starChamberUiApp").controller("CreateTemplateCtrl",["$scope","template","templateRESTService",function(a,b,c){a.helloWorld="Hello world",a.fontOptions=["Times new roman","Helvetica","Courier"],a.items={},console.log(b.data),angular.forEach(b.data.templateValues,function(b,c){a.items[b.textType]={"font-family":"Helvetica"}}),a.printDebug=function(){angular.forEach(b.data.templateValues,function(b,c){var d=a.items[b.textType],e="";switch(d["font-family"]){case"Times new roman":e="TIMES";break;default:e=d["font-family"].toUpperCase()}var f="bold"==d["font-weight"]?"T":"F",g="italic"==d["font-style"]?"T":"F",h=void 0==d["font-size"]?10:d["font-size"],i=void 0==d.color?"255,255,255":d.color.substring(4,d.color.length-1);b.formatString=e+","+f+","+g+","+h+","+i}),b.title=a.template.name,b.description=a.template.description,b.status=void 0,b.templateValues=b.data.templateValues,b.id=b.data.id,b.board=b.data.board,b.data=void 0,c.updateTemplate(b,function(a){alert(a)}),console.log(b)}}]),angular.module("starChamberUiApp").controller("InfoCtrl",["$scope","$rootScope","UserService",function(a,b,c){}]);